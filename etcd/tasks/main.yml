---
# tasks file for etcd
- name: 拷贝etcd文件
  copy:
    mode: +x
    src: ../../package/{{ item }}
    dest: /usr/local/bin
  loop:
    - etcd
    - etcdctl

- name: 创建etcd配置文件
  template:
    src: ./etcd.config.yml.j2
    dest: /etc/etcd/etcd.config.yml
  tags: ts

# - name: 创建etcd证书目录
#   file:
#     path: /etc/kubernetes/pki/etcd
#     state: directory
#   tags: ts

- name: 连接etcd证书目录
  # shell:
  #   cmd: "ln -s /etc/etcd/ssl/* /etc/kubernetes/pki/etcd/"
  # ignore_errors: yes
  tags: ts
  ignore_errors: yes
  file:
    state: link
    src: /etc/etcd/ssl
    dest: /etc/kubernetes/pki/etcd
    force: yes

- name: 创建etcd守护进程服务
  template:
    src: ./etcd.service.j2
    dest: /usr/lib/systemd/system/etcd.service
  notify: rs etcd
  tags: ts
